# ğŸ§± RabbitMQ ì´í•´ë¥¼ ìœ„í•œ ì „ì œ ì§€ì‹ ì •ë¦¬
## ì•„í‚¤í…ì²˜
```mermaid
sequenceDiagram
    autonumber
    participant Client as ğŸ§ Client (ì‚¬ìš©ì ìš”ì²­)
    participant API as ğŸ’» API ì„œë²„ (Producer)
    participant MQ as ğŸ“¬ RabbitMQ (Broker)
    participant Worker as âš™ï¸ Worker ì„œë²„ (Consumer)
    participant DB as ğŸ—„ï¸ DB

    Note over Client,DB: **ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬ íë¦„**

    Client->>API: ì£¼ë¬¸ ìš”ì²­ (POST /order)
    API->>DB: ì£¼ë¬¸ ë°ì´í„° ì €ì¥
    DB-->>API: ì €ì¥ ì™„ë£Œ (Success)
    API->>MQ: "ì£¼ë¬¸ ì™„ë£Œ" ë©”ì‹œì§€ ë°œí–‰ (Publish)
    MQ-->>API: ë©”ì‹œì§€ ìˆ˜ì‹  í™•ì¸ (ACK)
    API-->>Client: ì£¼ë¬¸ ì„±ê³µ ì‘ë‹µ (ì¦‰ì‹œ ë°˜í™˜)

    Note over API,Worker: ì´í›„ ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì‘

    MQ->>Worker: "ì£¼ë¬¸ ì™„ë£Œ" ë©”ì‹œì§€ ì „ë‹¬ (Consume)
    Worker->>DB: ì´ë©”ì¼ ì „ì†¡ ì´ë ¥ ì €ì¥
    Worker->>Client: (ì„ íƒì ìœ¼ë¡œ) ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ ì•Œë¦¼
```


### ğŸ” ë‹¤ì´ì–´ê·¸ë¨ í•´ì„

| ë‹¨ê³„ | ì„¤ëª… |
|------|------|
| **1.** Clientê°€ ì£¼ë¬¸ ìš”ì²­ì„ API ì„œë²„ì— ë³´ëƒ„ | ì‚¬ìš©ìëŠ” ë‹¨ìˆœíˆ "ì£¼ë¬¸í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­ |
| **2.** API ì„œë²„ëŠ” DBì— ì£¼ë¬¸ ì •ë³´ë¥¼ ì €ì¥ | í•µì‹¬ íŠ¸ëœì­ì…˜ì€ ì¦‰ì‹œ ì™„ë£Œë˜ì–´ì•¼ í•¨ |
| **3.** DBì— ì €ì¥ ì„±ê³µ í›„ RabbitMQë¡œ ì´ë²¤íŠ¸ ë°œí–‰ | `"order.created"` ê°™ì€ ë©”ì‹œì§€ë¥¼ MQë¡œ Publish |
| **4.** RabbitMQëŠ” ë©”ì‹œì§€ë¥¼ Queueì— ì•ˆì „í•˜ê²Œ ì €ì¥ | ACKìœ¼ë¡œ APIì— ì „ë‹¬ ì™„ë£Œ ì•Œë¦¼ |
| **5.** APIëŠ” í´ë¼ì´ì–¸íŠ¸ì— ë¹ ë¥´ê²Œ ì‘ë‹µ | ë¹„ë™ê¸° ì²˜ë¦¬ì´ë¯€ë¡œ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ |
| **6.** Worker(Consumer)ëŠ” MQì—ì„œ ë©”ì‹œì§€ë¥¼ êº¼ë‚´ í›„ì† ì‘ì—… ìˆ˜í–‰ | ì˜ˆ: ì´ë©”ì¼, í¬ì¸íŠ¸ ì ë¦½, ì•Œë¦¼ ë“± |
| **7.** Workerê°€ ì²˜ë¦¬ ì™„ë£Œ í›„ DBì— ê²°ê³¼ ê¸°ë¡ | ì¬ì‹œë„ë‚˜ ì¥ì•  ëŒ€ë¹„ ê°€ëŠ¥ |

---

#### ğŸ’¡ í•µì‹¬ ìš”ì•½

- **ë™ê¸°ì‹(ìš”ì²­-ì‘ë‹µ)** : Client â†” API â†” DB  
- **ë¹„ë™ê¸°ì‹(ì´ë²¤íŠ¸ ì²˜ë¦¬)** : API â†” RabbitMQ â†” Worker  
- **RabbitMQ ì—­í• **
  - ì‹œìŠ¤í…œ ê°„ ê²°í•©ë„ ìµœì†Œí™” (Decoupling)
  - ì¥ì•  ì‹œ ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€ (Persistent Queue)
  - ì²˜ë¦¬ëŸ‰ í­ì£¼ ì‹œ ë²„í¼ë§ ì—­í• 

---

#### ğŸ§­ íë¦„ ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬í•˜ë©´
```
Client
â†“ (ìš”ì²­)
API ì„œë²„
â†“ (DB ì €ì¥)
ë°ì´í„°ë² ì´ìŠ¤
â†³ ì„±ê³µ
â†“
RabbitMQ (ë©”ì‹œì§€ ë¸Œë¡œì»¤)
â†“
Worker ì„œë²„ (Consumer)
â†“
ì´ë©”ì¼ ë°œì†¡ / í¬ì¸íŠ¸ ì ë¦½ / ì•Œë¦¼ ì²˜ë¦¬
```
> ğŸ’¬ ì¦‰, **RabbitMQëŠ” ìš”ì²­-ì‘ë‹µ êµ¬ì¡°ì—ì„œ ë²—ì–´ë‚˜, â€œì´ë²¤íŠ¸ ê¸°ë°˜ ë¹„ë™ê¸° íë¦„â€ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ì¤‘ê°œì**ì´ë‹¤.


## 1ï¸âƒ£ ë©”ì‹œì§• ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ê°œë…

| êµ¬ì„±ìš”ì†Œ | ì„¤ëª… |
|-----------|------|
| **Producer** | ë©”ì‹œì§€ë¥¼ ìƒì„±í•´ ë³´ë‚´ëŠ” ì£¼ì²´. (ì˜ˆ: ì£¼ë¬¸ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰) |
| **Consumer** | ë©”ì‹œì§€ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” ì£¼ì²´. (ì˜ˆ: ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ) |
| **Broker** | ë©”ì‹œì§€ë¥¼ ì¤‘ê°œÂ·ì €ì¥Â·ë¶„ë°°í•˜ëŠ” ì„œë²„ (RabbitMQ, Kafka ë“±) |
| **Queue** | ë©”ì‹œì§€ê°€ ì†Œë¹„ë˜ê¸° ì „ ì„ì‹œë¡œ ì €ì¥ë˜ëŠ” ë²„í¼ ê³µê°„ |
| **Message** | ì‹¤ì œë¡œ ì „ë‹¬ë˜ëŠ” ë°ì´í„° ë‹¨ìœ„ (JSON, ë¬¸ìì—´, ê°ì²´ ë“±) |

> ğŸ’¡ ê¸°ë³¸ íë¦„: **Producer â†’ Broker â†’ Consumer**

---

## 2ï¸âƒ£ ë¹„ë™ê¸° í†µì‹  (RabbitMQì˜ í•„ìš”ì„±)

| êµ¬ë¶„ | ë™ê¸°(Synchronous) | ë¹„ë™ê¸°(Asynchronous) |
|------|--------------------|----------------------|
| ë°©ì‹ | ìš”ì²­ í›„ ì‘ë‹µê¹Œì§€ ê¸°ë‹¤ë¦¼ | ìš”ì²­ í›„ ë°”ë¡œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰ |
| ì˜ˆì‹œ | REST API í˜¸ì¶œ (ê²°ê³¼ ê¸°ë‹¤ë¦¼) | MQì— ì´ë²¤íŠ¸ë¥¼ ë„£ê³  ë‚˜ì¤‘ì— ì²˜ë¦¬ |
| ì¥ì  | ë‹¨ìˆœ, ì§ê´€ì  | ì‘ë‹µ ì§€ì—° ê°ì†Œ, í™•ì¥ì„± ë†’ìŒ |
| ë‹¨ì  | ëŠë¦¼, ë³‘ëª© ë°œìƒ | ë³µì¡í•œ ì„¤ê³„ í•„ìš” (í ê´€ë¦¬ ë“±) |

> ğŸš€ RabbitMQëŠ” ë¹„ë™ê¸° ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¥¼ ìœ„í•œ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì´ë‹¤.

---

## 3ï¸âƒ£ ë©”ì‹œì§€ í(Message Queue)ì˜ ì—­í• 

### âœ… ì™œ í•„ìš”í•œê°€?
- ì„œë¹„ìŠ¤ ê°„ **ê²°í•©ë„ ë‚®ì¶”ê¸° (Decoupling)**
- **íŠ¸ë˜í”½ í­ì£¼ ì œì–´ (Buffering)**
- **ë¹„ë™ê¸° ì²˜ë¦¬**ë¥¼ í†µí•œ **ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•**
- **ì‹ ë¢°ì„± ë³´ì¥ (ACK, ì¬ì‹œë„, DLQ ë“±)**

### ğŸ§  ì˜ˆì‹œ
> ì£¼ë¬¸ ì‹œìŠ¤í…œ(Producer)ì´ â€˜ì£¼ë¬¸ ì™„ë£Œâ€™ ë©”ì‹œì§€ë¥¼ MQì— ë„£ìœ¼ë©´,  
> ì´ë©”ì¼ ì‹œìŠ¤í…œ(Consumer)ì´ MQì—ì„œ ë©”ì‹œì§€ë¥¼ êº¼ë‚´ ì´ë©”ì¼ì„ ë°œì†¡í•œë‹¤.

---

## 4ï¸âƒ£ ë©”ì‹œì§• íŒ¨í„´ì˜ ê¸°ë³¸ êµ¬ì¡°

| íŒ¨í„´ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ë‹¨ìˆœ í(Simple Queue)** | 1:1 ë©”ì‹œì§• | ì£¼ë¬¸ â†’ ì´ë©”ì¼ ë°œì†¡ |
| **Fanout (Pub/Sub)** | 1:N ë©”ì‹œì§• (ëª¨ë“  Consumerì—ê²Œ ì „ë‹¬) | ì•Œë¦¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸ |
| **Direct** | ë¼ìš°íŒ…í‚¤ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • Consumerì—ê²Œ ì „ë‹¬ | ë¡œê·¸ ë ˆë²¨ë³„ í ë¶„ë¦¬ |
| **Topic** | ì™€ì¼ë“œì¹´ë“œ ê¸°ë°˜ ë¼ìš°íŒ… | `topic.key.*` í˜•íƒœ |
| **Header** | í—¤ë”ê°’ ì¡°ê±´ìœ¼ë¡œ ë¼ìš°íŒ… | í•„í„°ë§ ë©”ì‹œì§• |

---

## 5ï¸âƒ£ ì „ì†¡ ë³´ì¥ ìˆ˜ì¤€ (Delivery Guarantee)

| ìˆ˜ì¤€ | ì„¤ëª… |
|------|------|
| **At most once** | ìµœëŒ€ í•œ ë²ˆ ì „ë‹¬ (ìœ ì‹¤ ê°€ëŠ¥) |
| **At least once** | ìµœì†Œ í•œ ë²ˆ ì „ë‹¬ (ì¤‘ë³µ ê°€ëŠ¥) |
| **Exactly once** | ì •í™•íˆ í•œ ë²ˆ ì „ë‹¬ (ë³µì¡, íŠ¸ëœì­ì…˜ ê¸°ë°˜) |

> âš™ï¸ RabbitMQëŠ” ë³´í†µ **At least once** ì „ëµì„ ì‚¬ìš©í•˜ë©°  
> ACK/NACK, ì¬ì „ì†¡(requeue) ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì´ë¥¼ ë³´ì¥í•œë‹¤.

---

## 6ï¸âƒ£ AMQP í”„ë¡œí† ì½œ (RabbitMQì˜ í•µì‹¬)

RabbitMQëŠ” **AMQP (Advanced Message Queuing Protocol)** ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.

| êµ¬ì„±ìš”ì†Œ | ì„¤ëª… |
|-----------|------|
| **Exchange** | ë©”ì‹œì§€ë¥¼ ë°›ì•„ ë¼ìš°íŒ…í•˜ëŠ” ë¶„ë°°ê¸° |
| **Queue** | ë©”ì‹œì§€ë¥¼ ì„ì‹œ ì €ì¥í•˜ëŠ” ë²„í¼ |
| **Binding** | Exchange â†’ Queueë¡œ ë©”ì‹œì§€ë¥¼ ì—°ê²°í•˜ëŠ” ê·œì¹™ |
| **Routing Key** | ì–´ë–¤ Queueë¡œ ë³´ë‚¼ì§€ ê²°ì •í•˜ëŠ” ì‹ë³„ì |
| **Channel** | í•˜ë‚˜ì˜ TCP ì—°ê²° ë‚´ì—ì„œì˜ ë…¼ë¦¬ì  ì„¸ì…˜ |
| **Connection** | Producer/Consumer â†” Broker ê°„ ì‹¤ì œ TCP ì—°ê²° |

> ğŸ”„ **Exchange â†’ (Binding Rule) â†’ Queue â†’ Consumer**

---

## 7ï¸âƒ£ RabbitMQ vs Kafka ë¹„êµ

| í•­ëª© | RabbitMQ | Kafka |
|------|-----------|--------|
| ëª©ì  | ë©”ì‹œì§€ ë¸Œë¡œì»¤ (ì¦‰ì‹œ ì²˜ë¦¬ ì¤‘ì‹¬) | ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° (ëŒ€ìš©ëŸ‰ ì´ë²¤íŠ¸ ì¤‘ì‹¬) |
| í”„ë¡œí† ì½œ | **AMQP í‘œì¤€** | ìì²´ í”„ë¡œí† ì½œ |
| ëª¨ë¸ | Queue ê¸°ë°˜ (Push + Pull) | Log ê¸°ë°˜ (Pull Only) |
| ìˆœì„œ ë³´ì¥ | Queue ë‹¨ìœ„ | íŒŒí‹°ì…˜ ë‹¨ìœ„ |
| ì£¼ìš” ì‚¬ìš©ì²˜ | ì´ë©”ì¼/ê²°ì œ/ë¹„ë™ê¸° ì´ë²¤íŠ¸ | ë¡œê·¸ ìˆ˜ì§‘/ì‹¤ì‹œê°„ ë°ì´í„° íŒŒì´í”„ë¼ì¸ |

---

## âœ… ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì´ì œ RabbitMQ ìì²´ êµ¬ì¡°ë¡œ ë“¤ì–´ê°€ë©´ ëœë‹¤ ğŸ‘‡

### ğŸ“˜ RabbitMQ ë³¸ê²© ì •ë¦¬ ëª©ì°¨
1. RabbitMQë€? (ì—­ì‚¬ì™€ ê°œìš”)
2. AMQP ì•„í‚¤í…ì²˜ ìƒì„¸ êµ¬ì¡°
3. Exchange íƒ€ì…ë³„ ë™ì‘ (Direct, Topic, Fanout, Headers)
4. ë©”ì‹œì§€ ì „ë‹¬ ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (ACK, DLQ, TTL ë“±)
5. í´ëŸ¬ìŠ¤í„°ë§ & ê³ ê°€ìš©ì„± (HA Queue, Quorum Queue)
6. ìš´ì˜/ëª¨ë‹ˆí„°ë§ (Management UI, Channel ê´€ë¦¬)
7. Spring AMQP & Cloud Stream ì—°ë™ êµ¬ì¡°
8. Kafkaì™€ RabbitMQ ë¹„êµ (Use Case ì¤‘ì‹¬)

---

> ğŸ’¬ ë‹¤ìŒì€ â€œğŸ“˜ RabbitMQ ë³¸ê²© ì •ë¦¬ â€” 1ï¸âƒ£ RabbitMQë€?â€ ë¶€í„° ì‹œì‘

---


